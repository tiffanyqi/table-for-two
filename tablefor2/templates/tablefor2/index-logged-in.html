{% extends "tablefor2/base.html" %}
{% load staticfiles %}

{% block head %}
  {{ block.super }}
{% endblock %}

{% block content %}
  {% load static %}

    <div class="container">

      <div class="row">
        <div class="col-sm-8">

          <div class="group">
            <h1>Current Availabilities</h1>

            <h4>Add an Availability(?)</h4>
            <form action="{% url 'save-availability' %}" method="POST" class="post-form">{% csrf_token %}
              {% for field in form %}
                  {{ field.errors }}
                  {{ field }}
                  <button type="submit" class="save btn btn-default">
                      <span class="glyphicon glyphicon-plus"></span>
                  </button>
                  <br>
                  <p>Please format the time like the following: MM/DD/YYYY HH:MM (military time)</p>
              {% endfor %}
            </form>

            {% if not availabilities %}
              <p>Go set some availabilities below!</p>
            {% else %}

            <table class="table">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Matched?</th>
                  <th>Edit</th>
                  <th>Delete</th>
                </tr>
              </thead>
              <tbody>
                {% for availability in availabilities %}
                <tr>
                  <!-- edit popup -->
                  <form action="{% url 'edit-availability' availability.id %}" method="POST", class="edit-availability-form" id="form-edit-{{ availability.id }}">{% csrf_token %}
                    {% for field in form %}
                      <div class="fieldWrapper">
                        {{ field.errors }}
                        <td class="availability-edit {{ availability.id }}">{{ field }}</td>
                        <td class="availability-view {{ availability.id }}">{{ availability.time_available }}</td>
                        <td class="availability-view {{ availability.id }}">{{ availability.matched_name }}</td>
                        <td class="availability-edit {{ availability.id }}"> {{ field.help_text }}</td>
                      </div>
                    {% endfor %}
                    <!-- confirms edit -->
                    <td class="availability-edit {{ availability.id }}"><button type="submit" class="save btn btn-default">
                      <span class="glyphicon glyphicon-ok"></span>
                    </button></td>
                  </form>
                  
                  <!-- cancels edit and hides form -->
                  <td class="availability-edit {{ availability.id }}"><button class="save btn btn-default" onclick="editAvailability({{availability.id}})" id="btn-cancel-{{ availability.id }}">
                    <span class="glyphicon glyphicon-remove"></span>
                  </button></td>

                  <!-- opens the edit dialogue -->
                  <td class="availability-view {{ availability.id }}"><button class="save btn btn-default" id="btn-edit-{{ availability.id }}"onclick="editAvailability({{availability.id}})">
                    <span class="glyphicon glyphicon-pencil"></span>
                  </button></td>

                  <!-- confirms deletion, popup -->
<!--                   <td><button type="submit" class="save btn btn-default" onclick="deleteAvailability({{availability.id}})" id="btn-delete-{{ availability.id }}" method="POST">
                    <span class="glyphicon glyphicon-trash"></span>
                  </button></td> -->
                  <td class="availability-view {{ availability.id }}"><button type="submit" class="save btn btn-default" onclick="location.href='{% url 'delete-availability' availability.id %}'" id="btn-delete-{{ availability.id }}" method="POST">
                    <span class="glyphicon glyphicon-trash"></span>
                  </button></td>
                </tr>

              {% endfor %}
                
              </tbody>
            </table>
            {% endif %}

            <p>Moved recently? Change your location or settings <a href="{% url 'edit-profile' %}">here</a></p>

          </div>
        </div>
            
        <div class="col-sm-4">
          <div class="group">
            <h1>Current Matches</h1>

              {% if not current_matches %}
                <!-- <p>Go set some availabilities! Thanks for your patience :)</p> -->
                <!-- test for the real current matches -->
                <ul>
                  <li class="match">Test Qi at May 28, 2017, noon</li>
                  <li class="match">Test Qi at May 28, 2017, noon</li>
                  <li class="match">Test Qi at May 28, 2017, noon</li>
                </ul>
              {% else %}

              <ul>{% for current_match in current_matches %}
                <li>{{ current_match.matched_name}} at {{ current_match.time_available }}</li>
              {% endfor %}</ul>

              {% endif %}
          </div>
        </div>
      </div>
    </div>


  {% endblock %}

{% block bottom %}
  {{ block.super }}
  {% block bottom_js %}
    <script rel="javascript" type="text/javascript" src="{% static 'js/availability.js' %}"></script>
  {% endblock %}
{% endblock %}